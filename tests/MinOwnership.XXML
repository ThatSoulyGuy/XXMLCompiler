#import Language::Core;

[ Entrypoint
    {
        Run Console::printLine(String::Constructor("Starting..."));

        Instantiate Integer^ As <owned> = Integer::Constructor(42);
        Run Console::printLine(String::Constructor("Created owned"));
        Run Console::printLine(owned.toString());

        // Try to capture by reference
        Instantiate F(Integer^)()^ As <capRef> = [ Lambda [&owned] Returns Integer^ Parameters () {
            Return owned;
        }];

        Run Console::printLine(String::Constructor("Created lambda with ref capture"));

        Instantiate Integer^ As <result> = capRef.call();
        Run Console::printLine(String::Constructor("Called lambda"));
        Run Console::printLine(result.toString());

        Exit(0);
    }
]
