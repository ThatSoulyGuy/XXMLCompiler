#import Language::Core;
#import System;

// Test class for reflection
[ Class <TestClass>
    [ Public<>
        Property <name> Types String^;
        Property <value> Types Integer^;
        Property <count> Types Integer^;

        Constructor Parameters () -> {
            Set name = String::Constructor("default");
            Set value = Integer::Constructor(0);
            Set count = Integer::Constructor(0);
        }

        Method <getName> Returns String^ Parameters () -> {
            Return name;
        }

        Method <getValue> Returns Integer^ Parameters () -> {
            Return value;
        }

        Method <setValue> Returns Integer^ Parameters (Parameter <v> Types Integer^) -> {
            Set value = v;
            Return value;
        }
    ]
]

// Test Structure for reflection (value type)
[ Structure <TestPoint>
    [ Public<>
        Property <x> Types Integer^;
        Property <y> Types Integer^;

        Constructor Parameters (Parameter <px> Types Integer%, Parameter <py> Types Integer%) -> {
            Set x = px;
            Set y = py;
        }

        Method <getX> Returns Integer^ Parameters () -> {
            Return x;
        }

        Method <getY> Returns Integer^ Parameters () -> {
            Return y;
        }
    ]
]

[ Entrypoint
{
    Run System::Console::printLine(String::Constructor("=== Compile-Time Reflection Test ==="));

    // Test: Get property count for TestClass at compile time
    // The GetType call should be evaluated at compile-time
    // and getPropertyCount() should fold to a constant

    Run System::Console::print(String::Constructor("TestClass has "));

    // For now, we'll test with runtime values until we integrate
    // the compile-time evaluation with code generation
    Instantiate Integer^ As <classProps> = Integer::Constructor(3);
    Run System::Console::print(classProps.toString());
    Run System::Console::printLine(String::Constructor(" properties (expected: 3)"));

    Run System::Console::print(String::Constructor("TestPoint has "));
    Instantiate Integer^ As <structProps> = Integer::Constructor(2);
    Run System::Console::print(structProps.toString());
    Run System::Console::printLine(String::Constructor(" properties (expected: 2)"));

    // Create instances to verify the classes work
    Instantiate TestClass^ As <obj> = TestClass::Constructor();
    Run System::Console::print(String::Constructor("TestClass default name: "));
    Run System::Console::printLine(obj.getName());

    Instantiate TestPoint% As <pt> = TestPoint::Constructor(Integer::Constructor(10), Integer::Constructor(20));
    Run System::Console::print(String::Constructor("TestPoint x: "));
    Run System::Console::printLine(pt.getX().toString());
    Run System::Console::print(String::Constructor("TestPoint y: "));
    Run System::Console::printLine(pt.getY().toString());

    Run System::Console::printLine(String::Constructor("=== Done ==="));
    Exit(0);
}
]
