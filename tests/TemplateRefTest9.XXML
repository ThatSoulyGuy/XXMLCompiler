// Test using position property in T& method without multiplication

[ Namespace <Test>
	[ Class <Iterator> <T Constrains None> Final Extends None

		[ Private <>
			Property <dataPtr> Types NativeType<"ptr">^;
			Property <position> Types NativeType<"int64">^;
		]

		[ Public <>
			Constructor Parameters (Parameter <data> Types NativeType<"ptr">^) ->
			{
				Set dataPtr = data;
				Instantiate NativeType<"int64">^ As <zero> = 0;
				Set position = zero;
			}

			// Method returning T& using position without multiplication
			Method <current> Returns T& Parameters () Do
			{
				Instantiate NativeType<"ptr">^ As <offset> = dataPtr + position;
				Return Syscall::ptr_read(offset);
			}

			// Method that calls current()
			Method <next> Returns T^ Parameters () Do
			{
				Instantiate T^ As <elem> = this.current();
				Return elem;
			}
		]
	]
]

[ Entrypoint
	{
		Instantiate NativeType<"ptr">^ As <data> = 0;
		Instantiate Test::Iterator<Integer>^ As <iter> = Test::Iterator@Integer::Constructor(data);
		Exit(0);
	}
]
