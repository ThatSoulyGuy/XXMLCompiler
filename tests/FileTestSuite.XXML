#import Language::Core;
#import Language::IO;

// Comprehensive File I/O Test Suite

[ Entrypoint
    {
        Run Console::printLine(String::Constructor(""));
        Run Console::printLine(String::Constructor("========================================"));
        Run Console::printLine(String::Constructor("    XXML File I/O Test Suite"));
        Run Console::printLine(String::Constructor("========================================"));

        // ==========================================
        // SECTION 1: Basic Operations
        // ==========================================
        Run Console::printLine(String::Constructor(""));
        Run Console::printLine(String::Constructor("[SECTION 1: Basic Operations]"));

        // Test 1.1: Create and write file
        Run Console::printLine(String::Constructor("  1.1 Create/Write file... "));
        Instantiate IO::File^ As <f1> = IO::File::Constructor(
            String::Constructor("test_basic.txt"),
            String::Constructor("w")
        );
        Run f1.writeLine(String::Constructor("Hello World"));
        Run f1.close();
        Run Console::printLine(String::Constructor("      PASS"));

        // Test 1.2: Check exists
        Run Console::printLine(String::Constructor("  1.2 File exists... "));
        Instantiate Bool^ As <exists1> = IO::File::exists(String::Constructor("test_basic.txt"));
        If (exists1) -> {
            Run Console::printLine(String::Constructor("      PASS"));
        } Else -> {
            Run Console::printLine(String::Constructor("      FAIL"));
        }

        // Test 1.3: Get file size
        Run Console::printLine(String::Constructor("  1.3 File size... "));
        Instantiate Integer^ As <size1> = IO::File::sizeOf(String::Constructor("test_basic.txt"));
        Run Console::printLine(String::Constructor("      Size = "));
        Run Console::printLine(size1.toString());

        // Test 1.4: Read all content
        Run Console::printLine(String::Constructor("  1.4 Read all... "));
        Instantiate String^ As <content1> = IO::File::readAll(String::Constructor("test_basic.txt"));
        Run Console::printLine(String::Constructor("      Content = ["));
        Run Console::printLine(content1);
        Run Console::printLine(String::Constructor("      ]"));

        // Test 1.5: Read line by line
        Run Console::printLine(String::Constructor("  1.5 Read line... "));
        Instantiate IO::File^ As <f1r> = IO::File::Constructor(
            String::Constructor("test_basic.txt"),
            String::Constructor("r")
        );
        Instantiate String^ As <line1> = f1r.readLine();
        Run f1r.close();
        Run Console::printLine(String::Constructor("      Line = ["));
        Run Console::printLine(line1);
        Run Console::printLine(String::Constructor("      ]"));

        // Cleanup
        Run IO::File::delete(String::Constructor("test_basic.txt"));

        // ==========================================
        // SECTION 2: Multiple Lines
        // ==========================================
        Run Console::printLine(String::Constructor(""));
        Run Console::printLine(String::Constructor("[SECTION 2: Multiple Lines]"));

        // Test 2.1: Write multiple lines
        Run Console::printLine(String::Constructor("  2.1 Write 5 lines... "));
        Instantiate IO::File^ As <f2> = IO::File::Constructor(
            String::Constructor("test_multi.txt"),
            String::Constructor("w")
        );
        Run f2.writeLine(String::Constructor("Line 1: Alpha"));
        Run f2.writeLine(String::Constructor("Line 2: Beta"));
        Run f2.writeLine(String::Constructor("Line 3: Gamma"));
        Run f2.writeLine(String::Constructor("Line 4: Delta"));
        Run f2.writeLine(String::Constructor("Line 5: Epsilon"));
        Run f2.close();
        Run Console::printLine(String::Constructor("      PASS"));

        // Test 2.2: Read all lines sequentially
        Run Console::printLine(String::Constructor("  2.2 Read lines sequentially... "));
        Instantiate IO::File^ As <f2r> = IO::File::Constructor(
            String::Constructor("test_multi.txt"),
            String::Constructor("r")
        );
        Instantiate String^ As <ml1> = f2r.readLine();
        Instantiate String^ As <ml2> = f2r.readLine();
        Instantiate String^ As <ml3> = f2r.readLine();
        Instantiate String^ As <ml4> = f2r.readLine();
        Instantiate String^ As <ml5> = f2r.readLine();
        Run f2r.close();
        Run Console::printLine(String::Constructor("      L1: "));
        Run Console::printLine(ml1);
        Run Console::printLine(String::Constructor("      L5: "));
        Run Console::printLine(ml5);

        // Cleanup
        Run IO::File::delete(String::Constructor("test_multi.txt"));

        // ==========================================
        // SECTION 3: Special Content
        // ==========================================
        Run Console::printLine(String::Constructor(""));
        Run Console::printLine(String::Constructor("[SECTION 3: Special Content]"));

        // Test 3.1: Numbers
        Run Console::printLine(String::Constructor("  3.1 Numbers... "));
        Instantiate IO::File^ As <f3a> = IO::File::Constructor(
            String::Constructor("test_numbers.txt"),
            String::Constructor("w")
        );
        Run f3a.writeLine(String::Constructor("0123456789"));
        Run f3a.writeLine(String::Constructor("-123.456"));
        Run f3a.close();
        Instantiate String^ As <numContent> = IO::File::readAll(String::Constructor("test_numbers.txt"));
        Run Console::printLine(numContent);
        Run IO::File::delete(String::Constructor("test_numbers.txt"));

        // Test 3.2: Special characters
        Run Console::printLine(String::Constructor("  3.2 Special chars... "));
        Instantiate IO::File^ As <f3b> = IO::File::Constructor(
            String::Constructor("test_special.txt"),
            String::Constructor("w")
        );
        Run f3b.writeLine(String::Constructor("!@#$%^&*()"));
        Run f3b.writeLine(String::Constructor("<>[]{}"));
        Run f3b.close();
        Instantiate String^ As <specContent> = IO::File::readAll(String::Constructor("test_special.txt"));
        Run Console::printLine(specContent);
        Run IO::File::delete(String::Constructor("test_special.txt"));

        // Test 3.3: Whitespace
        Run Console::printLine(String::Constructor("  3.3 Whitespace... "));
        Instantiate IO::File^ As <f3c> = IO::File::Constructor(
            String::Constructor("test_ws.txt"),
            String::Constructor("w")
        );
        Run f3c.writeLine(String::Constructor("  leading"));
        Run f3c.writeLine(String::Constructor("trailing  "));
        Run f3c.writeLine(String::Constructor("   both   "));
        Run f3c.close();
        Instantiate IO::File^ As <f3cr> = IO::File::Constructor(
            String::Constructor("test_ws.txt"),
            String::Constructor("r")
        );
        Instantiate String^ As <ws1> = f3cr.readLine();
        Instantiate String^ As <ws2> = f3cr.readLine();
        Instantiate String^ As <ws3> = f3cr.readLine();
        Run f3cr.close();
        Run Console::printLine(String::Constructor("      ["));
        Run Console::printLine(ws1);
        Run Console::printLine(String::Constructor("]"));
        Run Console::printLine(String::Constructor("      ["));
        Run Console::printLine(ws2);
        Run Console::printLine(String::Constructor("]"));
        Run IO::File::delete(String::Constructor("test_ws.txt"));

        // ==========================================
        // SECTION 4: File Operations
        // ==========================================
        Run Console::printLine(String::Constructor(""));
        Run Console::printLine(String::Constructor("[SECTION 4: File Operations]"));

        // Create source file
        Instantiate IO::File^ As <f4> = IO::File::Constructor(
            String::Constructor("test_source.txt"),
            String::Constructor("w")
        );
        Run f4.writeLine(String::Constructor("Source file content"));
        Run f4.close();

        // Test 4.1: Copy
        Run Console::printLine(String::Constructor("  4.1 Copy file... "));
        Instantiate Bool^ As <copyResult> = IO::File::copy(
            String::Constructor("test_source.txt"),
            String::Constructor("test_copy.txt")
        );
        If (copyResult) -> {
            Run Console::printLine(String::Constructor("      PASS"));
        } Else -> {
            Run Console::printLine(String::Constructor("      FAIL"));
        }

        // Verify copy
        Instantiate Bool^ As <copyExists> = IO::File::exists(String::Constructor("test_copy.txt"));
        Run Console::printLine(String::Constructor("  4.1b Copy exists... "));
        If (copyExists) -> {
            Run Console::printLine(String::Constructor("      PASS"));
        } Else -> {
            Run Console::printLine(String::Constructor("      FAIL"));
        }

        // Test 4.2: Rename
        Run Console::printLine(String::Constructor("  4.2 Rename file... "));
        Instantiate Bool^ As <renameResult> = IO::File::rename(
            String::Constructor("test_copy.txt"),
            String::Constructor("test_renamed.txt")
        );
        If (renameResult) -> {
            Run Console::printLine(String::Constructor("      PASS"));
        } Else -> {
            Run Console::printLine(String::Constructor("      FAIL"));
        }

        // Verify rename
        Instantiate Bool^ As <oldExists> = IO::File::exists(String::Constructor("test_copy.txt"));
        Instantiate Bool^ As <newExists> = IO::File::exists(String::Constructor("test_renamed.txt"));
        Run Console::printLine(String::Constructor("  4.2b Old gone, new exists... "));
        If (oldExists) -> {
            Run Console::printLine(String::Constructor("      FAIL (old still exists)"));
        } Else -> {
            If (newExists) -> {
                Run Console::printLine(String::Constructor("      PASS"));
            } Else -> {
                Run Console::printLine(String::Constructor("      FAIL (new not found)"));
            }
        }

        // Test 4.3: Delete
        Run Console::printLine(String::Constructor("  4.3 Delete files... "));
        Run IO::File::delete(String::Constructor("test_source.txt"));
        Run IO::File::delete(String::Constructor("test_renamed.txt"));
        Instantiate Bool^ As <srcGone> = IO::File::exists(String::Constructor("test_source.txt"));
        Instantiate Bool^ As <renGone> = IO::File::exists(String::Constructor("test_renamed.txt"));
        If (srcGone) -> {
            Run Console::printLine(String::Constructor("      FAIL"));
        } Else -> {
            If (renGone) -> {
                Run Console::printLine(String::Constructor("      FAIL"));
            } Else -> {
                Run Console::printLine(String::Constructor("      PASS"));
            }
        }

        // ==========================================
        // SECTION 5: Edge Cases
        // ==========================================
        Run Console::printLine(String::Constructor(""));
        Run Console::printLine(String::Constructor("[SECTION 5: Edge Cases]"));

        // Test 5.1: Empty file
        Run Console::printLine(String::Constructor("  5.1 Empty file... "));
        Instantiate IO::File^ As <f5a> = IO::File::Constructor(
            String::Constructor("test_empty.txt"),
            String::Constructor("w")
        );
        Run f5a.close();
        Instantiate Integer^ As <emptySize> = IO::File::sizeOf(String::Constructor("test_empty.txt"));
        Run Console::printLine(String::Constructor("      Size = "));
        Run Console::printLine(emptySize.toString());
        Instantiate String^ As <emptyContent> = IO::File::readAll(String::Constructor("test_empty.txt"));
        Run Console::printLine(String::Constructor("      Content = ["));
        Run Console::printLine(emptyContent);
        Run Console::printLine(String::Constructor("]"));
        Run IO::File::delete(String::Constructor("test_empty.txt"));

        // Test 5.2: Long line (100 chars)
        Run Console::printLine(String::Constructor("  5.2 Long line (100 chars)... "));
        Instantiate IO::File^ As <f5b> = IO::File::Constructor(
            String::Constructor("test_long.txt"),
            String::Constructor("w")
        );
        Run f5b.writeLine(String::Constructor("AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"));
        Run f5b.close();
        Instantiate IO::File^ As <f5br> = IO::File::Constructor(
            String::Constructor("test_long.txt"),
            String::Constructor("r")
        );
        Instantiate String^ As <longLine> = f5br.readLine();
        Run f5br.close();
        Run Console::printLine(String::Constructor("      Content = ["));
        Run Console::printLine(longLine);
        Run Console::printLine(String::Constructor("]"));
        Run IO::File::delete(String::Constructor("test_long.txt"));

        // Test 5.3: Single character
        Run Console::printLine(String::Constructor("  5.3 Single char... "));
        Instantiate IO::File^ As <f5c> = IO::File::Constructor(
            String::Constructor("test_single.txt"),
            String::Constructor("w")
        );
        Run f5c.writeString(String::Constructor("X"));
        Run f5c.close();
        Instantiate String^ As <singleContent> = IO::File::readAll(String::Constructor("test_single.txt"));
        Run Console::printLine(String::Constructor("      Content = ["));
        Run Console::printLine(singleContent);
        Run Console::printLine(String::Constructor("]"));
        Run IO::File::delete(String::Constructor("test_single.txt"));

        // Test 5.4: Non-existent file
        Run Console::printLine(String::Constructor("  5.4 Non-existent file... "));
        Instantiate Bool^ As <noFile> = IO::File::exists(String::Constructor("this_does_not_exist_12345.txt"));
        If (noFile) -> {
            Run Console::printLine(String::Constructor("      FAIL (shouldn't exist)"));
        } Else -> {
            Run Console::printLine(String::Constructor("      PASS (correctly reports not found)"));
        }

        // ==========================================
        // SECTION 6: Stress Test
        // ==========================================
        Run Console::printLine(String::Constructor(""));
        Run Console::printLine(String::Constructor("[SECTION 6: Stress Test]"));

        // Test 6.1: Write many lines
        Run Console::printLine(String::Constructor("  6.1 Write 20 lines... "));
        Instantiate IO::File^ As <f6> = IO::File::Constructor(
            String::Constructor("test_stress.txt"),
            String::Constructor("w")
        );
        Run f6.writeLine(String::Constructor("Line 01"));
        Run f6.writeLine(String::Constructor("Line 02"));
        Run f6.writeLine(String::Constructor("Line 03"));
        Run f6.writeLine(String::Constructor("Line 04"));
        Run f6.writeLine(String::Constructor("Line 05"));
        Run f6.writeLine(String::Constructor("Line 06"));
        Run f6.writeLine(String::Constructor("Line 07"));
        Run f6.writeLine(String::Constructor("Line 08"));
        Run f6.writeLine(String::Constructor("Line 09"));
        Run f6.writeLine(String::Constructor("Line 10"));
        Run f6.writeLine(String::Constructor("Line 11"));
        Run f6.writeLine(String::Constructor("Line 12"));
        Run f6.writeLine(String::Constructor("Line 13"));
        Run f6.writeLine(String::Constructor("Line 14"));
        Run f6.writeLine(String::Constructor("Line 15"));
        Run f6.writeLine(String::Constructor("Line 16"));
        Run f6.writeLine(String::Constructor("Line 17"));
        Run f6.writeLine(String::Constructor("Line 18"));
        Run f6.writeLine(String::Constructor("Line 19"));
        Run f6.writeLine(String::Constructor("Line 20"));
        Run f6.close();
        Run Console::printLine(String::Constructor("      PASS"));

        // Test 6.2: Read all 20 lines
        Run Console::printLine(String::Constructor("  6.2 Read 20 lines... "));
        Instantiate IO::File^ As <f6r> = IO::File::Constructor(
            String::Constructor("test_stress.txt"),
            String::Constructor("r")
        );
        Instantiate String^ As <s1> = f6r.readLine();
        Instantiate String^ As <s2> = f6r.readLine();
        Instantiate String^ As <s3> = f6r.readLine();
        Instantiate String^ As <s4> = f6r.readLine();
        Instantiate String^ As <s5> = f6r.readLine();
        Instantiate String^ As <s6> = f6r.readLine();
        Instantiate String^ As <s7> = f6r.readLine();
        Instantiate String^ As <s8> = f6r.readLine();
        Instantiate String^ As <s9> = f6r.readLine();
        Instantiate String^ As <s10> = f6r.readLine();
        Instantiate String^ As <s11> = f6r.readLine();
        Instantiate String^ As <s12> = f6r.readLine();
        Instantiate String^ As <s13> = f6r.readLine();
        Instantiate String^ As <s14> = f6r.readLine();
        Instantiate String^ As <s15> = f6r.readLine();
        Instantiate String^ As <s16> = f6r.readLine();
        Instantiate String^ As <s17> = f6r.readLine();
        Instantiate String^ As <s18> = f6r.readLine();
        Instantiate String^ As <s19> = f6r.readLine();
        Instantiate String^ As <s20> = f6r.readLine();
        Run f6r.close();
        Run Console::printLine(String::Constructor("      First: "));
        Run Console::printLine(s1);
        Run Console::printLine(String::Constructor("      Last: "));
        Run Console::printLine(s20);
        Run IO::File::delete(String::Constructor("test_stress.txt"));

        // ==========================================
        // FINAL SUMMARY
        // ==========================================
        Run Console::printLine(String::Constructor(""));
        Run Console::printLine(String::Constructor("========================================"));
        Run Console::printLine(String::Constructor("    ALL TESTS COMPLETE"));
        Run Console::printLine(String::Constructor("========================================"));
        Run Console::printLine(String::Constructor(""));

        Exit(0);
    }
]
